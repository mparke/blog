<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://www.linode.com/favicon.ico" type="image/x-icon" />
    <link rel="alternate" title="RSS" href="http://engineering.linode.com/feed.xml">
    <title>
      
      
      Taking Risks - API Labels and Prefixes Rollback - Linode Engineering Blog
      
      
    </title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/css/blog.css" />
  </head>
  <body>
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-M3XXZX"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M3XXZX');</script>
    <!-- End Google Tag Manager -->
    <header class="clearfix">
  <nav id="main-nav" class="container" role="navigation">
    <a class="navbar-brand" href="/">
      <img id="navbar-logo" src="https://www.linode.com/media/images/header/linode-logo.svg"
           width="115" height="45" />
    </a>
    <span class="nav-text nav-title">
      Engineering
    </span>
    <span class="nav-text float-xs-right">
      <a href="https://linode.com/careers">We're hiring!</a>
    </span>
  </nav>
</header>

    <div class="container">
  <div class="row">
    <div class="col-md-3">
      <sidebar>
  <section>
    <h3>Popular posts</h3>
    <div class="recommended"><a href="#">API Alpha Events Rollout</a></div>
  </section>
  <section>
    <h3>Popular tags</h3>
    <div class='tags'><a href='/tags/APIv4'>APIv4 (9)</a></div><div class='tags'><a href='/tags/Manager'>Manager (4)</a></div><div class='tags'><a href='/tags/Python-Flask'>Python/Flask (1)</a></div>
  </section>
</sidebar>

    </div>
    <div class="col-sm-7">
      <article>
        <div class="article-tags">APIv4</div>
        <h1 class="article-title">Taking Risks - API Labels and Prefixes Rollback</h1>
        <header class="article-header">
          <span class="article-date">31 Aug 2016</span>, by
          <span class="article-author">Will Smith</span>
          <img class="article-avatar" src="https://www.linode.com/media/images/employees/wsmith.png" alt="Will Smith" width="25" />
        </header>
        <div class="article-content">
          <p>Part of the intention behind development of the Linode API v4 Public Alpha 
has been to try new
ideas and get feedback before customers are dependant on the API for their
day-to-day work. This gives us the freedom to take risks we would
otherwise shy away from without fear of long-term consequences if
they didn’t pan out. If we didn’t end up rolling back at least once experimental
feature, we would have missed the whole point and I wouldn’t be writing a blog post
like this.  But we took a risk - and missed. So, with a heavy heart,
I must announce a rollback and confirm that we have removed “labels” from most
endpoints in the API.</p>

<h3 id="label-trouble">Label Trouble</h3>

<p><a href="https://engineering.linode.com/2016/07/26/Labels-Rollout.html">Last time</a> I wrote
our blog post, we were proudly rolling out labels to most API endpoints. The idea was
as simple as it was elegant - in place of meaningless numeric identifiers, use
the “label” property (or equivalent) of the object as it’s unique identifier. It
resulted in very digestible URLs like these:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>https://api.alpha.linode.com/v4/linodes/example
https://api.alpha.linode.com/v4/dnszones/example.org
https://api.alpha.linode.com/v4/distributions/linode/ubuntu15.10
</code></pre>
</div>

<p>The concept wasn’t without issue, however; many resources don’t require labels
to be unique, and while it made lots of sense for some endpoints (Linodes, DNSZones, Distributions),
others were more of a stretch (Disks, Linode Configs, Backups). This was complicated by
verbose, automatic labels given to resources like Disks and Configs, making URLs
much less elegant.  We were also able to identify a slew of edge cases that would create
collisions or confusion no matter how we approached them.</p>

<p>We discussed rule-making options for when labels would or would not be supported, and
came up with the following:</p>

<p><em>A resource’s identifier will be a label if the resource’s label does not commonly change,
is controlled by Linode, and if the resource is public.</em></p>

<p>This rule helps keep labels in some of the most useful places, while avoiding all of the
complications that labels can create.  The following resources retain their labels:</p>

<ul>
  <li>Services</li>
  <li>Datacenters</li>
  <li>Distributions</li>
  <li>Kernels</li>
</ul>

<p>This rule still gives you the very clean deployment code (example uses the
<a href="https://github.com/linode/python-linode-api">python library</a>):</p>

<pre><code class="language-python3">client = linode.LinodeClient(my_token)
linode = client.create_linode('linode2048.5', 'newark', source='linode/ubuntu15.10')
</code></pre>

<h3 id="identity-types">Identity Types</h3>

<p>As a consequence of rolling back labels, we’ve also changed the type of identifiers for objects that are not
labelled.  Previously, we used prefixed IDs, like “linode_123”.  While the built-in type information
allowed you to do 
<a href="https://github.com/linode/python-linode-api/blob/1425dd22c07b19d21f78696d4c1c855450dce911/linode/mappings.py#L29">cool things</a>,
it wasn’t actually useful in most cases, and most people we talked to wanted a simple <code class="highlighter-rouge">int</code> instead
of a string.  Now, IDs of objects that don’t have labels will be <code class="highlighter-rouge">ints</code>.  For example, the three URLs
above become this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>https://api.alpha.linode.com/v4/linodes/123
https://api.alpha.linode.com/v4/dnszones/456
https://api.alpha.linode.com/v4/distributions/linode/ubuntu15.10
</code></pre>
</div>

<p>Likewise, a Linode object might look like this:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="nt">"datacenter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"us"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newark"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Newark"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"distribution"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"group"</span><span class="p">:</span><span class="w"> </span><span class="s2">"demo"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span><span class="w">
  </span><span class="nt">"ips"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"private"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ipv4"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nt">"link_local"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fe80::f03c:91ff:fe96:46f5"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"public"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"failover"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nt">"ipv4"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"172.28.4.8"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"ipv6"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2a01:7e00::f03c:91ff:fe96:46f5"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"example"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hourly_price"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
      </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linode2048.5"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Linode 1024"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"mbits_out"</span><span class="p">:</span><span class="w"> </span><span class="mi">125</span><span class="p">,</span><span class="w">
      </span><span class="nt">"monthly_price"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">,</span><span class="w">
      </span><span class="nt">"ram"</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w">
      </span><span class="nt">"service_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"linode"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"storage"</span><span class="p">:</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w">
      </span><span class="nt">"transfer"</span><span class="p">:</span><span class="w"> </span><span class="mi">2000</span><span class="p">,</span><span class="w">
      </span><span class="nt">"vcpus"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"provisioning"</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre>
</div>

<h3 id="networking-nodebalancers-etc">Networking, Nodebalancers, etc.</h3>

<p>In this deployment we’re also expanding the <code class="highlighter-rouge">/linodes/:id/ips</code> response to include
IPv6 information; it now looks like this:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"ipv4"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"172.28.4.8"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">201414</span><span class="p">,</span><span class="w">
            </span><span class="nt">"rdns"</span><span class="p">:</span><span class="w"> </span><span class="s2">"li1-8.members.linode.com"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"ipv6"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2a01:7e00::f03c:91ff:fe96:46f5/64"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"public"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"range"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fe80::f03c:91ff:fe96:46f5/64"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"private"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>We’ve also continued down the path of Nodebalancer support, which should be ready for tinkering
in the near future.</p>

<p>As always, thanks for your continued support and feedback.  Don’t forget to stop by 
<a href="https://webchat.oftc.net/?channels=linode-next&amp;uio=d4">#linode-next on oftc</a>
to let us know how it’s going, and stay tuned at our <a href="https://github.com/linode">github</a>
for updates to our open-source projects.</p>

        </div>
      </acticle>
    </div>
  </div>
</div>

    <footer class="container">
      <div class="row">
        <div class="col-md-10 text-xs-right">
          <span class="text-muted">
            &copy; Linode 2016, CC-BY-SA 4.0<br />
            <a href="https://github.com/Linode/blog">
              Source available on GitHub
              <i class="fa fa-github"></i>
            </a>
          </span>
        </div>
      </div>
    </footer>
  </body>
</html>
