<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://www.linode.com/favicon.ico" type="image/x-icon" />
    <link rel="alternate" title="RSS" href="http://engineering.linode.com/feed.xml">
    <title>
      
      
      Connecting our API to Redux with higher-order functions - Linode Engineering Blog
      
      
    </title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="/css/blog.css" />
  </head>
  <body>
    <!-- Google Tag Manager -->
    <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-M3XXZX"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M3XXZX');</script>
    <!-- End Google Tag Manager -->
    <header class="clearfix">
  <nav id="main-nav" class="container" role="navigation">
    <a class="navbar-brand" href="/">
      <img id="navbar-logo" src="https://www.linode.com/media/images/header/linode-logo.svg"
           width="115" height="45" />
    </a>
    <span class="nav-text nav-title">
      Engineering
    </span>
    <span class="nav-text float-xs-right">
      <a href="https://linode.com/careers">We're hiring!</a>
    </span>
  </nav>
</header>

    <div class="container">
  <div class="row">
    <div class="col-md-3">
      <sidebar>
  <section>
    <h3>Popular posts</h3>
    <div class="recommended"><a href="#">API Alpha Events Rollout</a></div>
  </section>
  <section>
    <h3>Popular tags</h3>
    <div class='tags'><a href='/tags/APIv4'>APIv4 (9)</a></div><div class='tags'><a href='/tags/Manager'>Manager (4)</a></div><div class='tags'><a href='/tags/Python-Flask'>Python/Flask (1)</a></div>
  </section>
</sidebar>

    </div>
    <div class="col-sm-7">
      <article>
        <div class="article-tags">Manager</div>
        <h1 class="article-title">Connecting our API to Redux with higher-order functions</h1>
        <header class="article-header">
          <span class="article-date">17 Aug 2016</span>, by
          <span class="article-author">Drew DeVault</span>
          <img class="article-avatar" src="https://www.linode.com/media/images/employees/ddevault.png" alt="Drew DeVault" width="25" />
        </header>
        <div class="article-content">
          <p>In our work on the
<a href="https://engineering.linode.com/2016/05/16/Announcing-the-new-open-source-manager.html">new Linode Manager</a>,
we’ve put some effort into finding reusable ways to manage information from our
API with the Manager’s Redux store. We ended up building a module that uses
higher order functions to generate Redux reducers and action creators for this
purpose.</p>

<p>Our new API uses a <a href="https://developers.linode.com/reference/">consistent, RESTful
design</a>, and we wanted to have a
consistent interface for talking to it. The API has support for <em>lists</em> of
<em>resources</em>, and we built a system wherein we could write up a configuration
object describing a set of endpoints and have the API module generate Redux
reducers and action creators for those endpoints. For a simple example, here’s
our distributions reducer, which connects to <a href="https://developers.linode.com/reference/#ep-distributions">this
API</a>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">distroConfig</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'~/actions/api/distros'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">makeApiList</span> <span class="nx">from</span> <span class="s1">'~/api-store'</span><span class="p">;</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">makeApiList</span><span class="p">(</span><span class="nx">distroConfig</span><span class="p">);</span>
</code></pre>
</div>

<p>Pretty straightforward! Here’s the code for the action creator module:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">makeFetchPage</span><span class="p">,</span> <span class="nx">makeFetchAll</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'~/api-store'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_DISTROS</span> <span class="o">=</span> <span class="s1">'@@distributions/UPDATE_DISTROS'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">distroConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">singular</span><span class="p">:</span> <span class="s1">'distribution'</span><span class="p">,</span>
  <span class="na">plural</span><span class="p">:</span> <span class="s1">'distributions'</span><span class="p">,</span>
  <span class="na">actions</span><span class="p">:</span> <span class="p">{</span> <span class="na">updateItems</span><span class="p">:</span> <span class="nx">UPDATE_DISTROS</span> <span class="p">},</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchDistros</span> <span class="o">=</span> <span class="nx">makeFetchPage</span><span class="p">(</span><span class="nx">distroConfig</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchAllDistros</span> <span class="o">=</span> <span class="nx">makeFetchAll</span><span class="p">(</span><span class="nx">distroConfig</span><span class="p">,</span> <span class="nx">fetchDistros</span><span class="p">);</span>
</code></pre>
</div>

<p>Here we define the <code class="highlighter-rouge">UPDATE_DISTROS</code> Redux action, which will take a list of
distributions returned by the API and update them in the Redux store. The
<code class="highlighter-rouge">distroConfig</code> object contains a configuration with the plural and singular
forms of the resource (as the API knows them) as well as a list of actions the
generated reducer should support. The action creators <code class="highlighter-rouge">fetchDistros</code> and
<code class="highlighter-rouge">fetchAllDistros</code> are created and exported from here. In the reducer module, we
import the same <code class="highlighter-rouge">distroConfig</code> and pass it into the <code class="highlighter-rouge">makeApiList</code> function,
which creates a reducer for this config. Thus, fetching all distros from the API
and putting them into the Redux store is as simple as this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span> <span class="nx">fetchAllDistros</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'~/actions/api/distros'</span><span class="p">;</span>
<span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchAllDistros</span><span class="p">());</span>
</code></pre>
</div>

<h2 id="generating-action-creators">Generating action creators</h2>

<p>Let’s dig into how this stuff works. We’ll start with the simple: the
<code class="highlighter-rouge">makeFetchPage</code> meta action creator. Here’s the code for it, with some features
removed for simplicity’s sake:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">export</span> <span class="kd">function</span> <span class="nx">makeFetchPage</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">fetchPage</span><span class="p">(</span><span class="nx">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="p">{</span> <span class="nx">token</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">().</span><span class="nx">authentication</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">getPath</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="err">`</span><span class="nx">$</span><span class="p">{</span><span class="nx">path</span><span class="p">}?</span><span class="nx">page</span><span class="o">=</span><span class="nx">$</span><span class="p">{</span><span class="nx">page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
      <span class="nx">dispatch</span><span class="p">({</span>
        <span class="na">type</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">,</span>
        <span class="na">response</span><span class="p">:</span> <span class="nx">json</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">json</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">fetchPage</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The <a href="https://github.com/linode/manager/blob/9757e6455556d12bba0864a3050c4293b5ec9bd0/src/api-store.js#L211-L255">full
version</a>
includes code for filtering, caching, and subresources, which is omitted
here. The function we see here is a <a href="https://en.wikipedia.org/wiki/Higher-order_function">higher order
function</a>: a function that
operates on functions. The returned function is a Redux <a href="http://redux.js.org/docs/basics/Actions.html#action-creators">action
creator</a> that
returns a <a href="https://github.com/gaearon/redux-thunk">thunk</a>. When dispatched, this
async function grabs your API token from the Redux store and gets the path in
the API this resource lives at (for example <code class="highlighter-rouge">/linodes/:id</code>). We fetch this from
the API and then dispatch an action whose type comes from the config and whose
payload is the API response.</p>

<p>The <code class="highlighter-rouge">makeFetchAll</code> implementation is quite simple with this in place:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">export</span> <span class="kd">function</span> <span class="nx">makeFetchAll</span><span class="p">(</span><span class="nx">config</span><span class="p">,</span> <span class="nx">fetchPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">async</span> <span class="p">(</span><span class="nx">dispatch</span><span class="p">,</span> <span class="nx">getState</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="p">{</span> <span class="nx">state</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">getState</span><span class="p">().</span><span class="nx">api</span><span class="p">[</span><span class="nx">config</span><span class="p">.</span><span class="nx">plural</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">totalPages</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchPage</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">...</span><span class="nx">ids</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">state</span><span class="p">.</span><span class="nx">totalPages</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">pagesFetched</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">await</span> <span class="nx">dispatch</span><span class="p">(</span><span class="nx">fetchPage</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="p">...</span><span class="nx">ids</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre>
</div>

<p>This is again a bit simplified from the <a href="https://github.com/linode/manager/blob/9757e6455556d12bba0864a3050c4293b5ec9bd0/src/api-store.js#L257-L282">full
version</a>,
but the basic idea is here. I love ES7’s async/await syntax!</p>

<h2 id="generating-reducers">Generating reducers</h2>

<p>In our distros example, there was also a one-liner that took a config and
generated a <a href="http://redux.js.org/docs/basics/Reducers.html">Redux reducer</a>:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">export</span> <span class="k">default</span> <span class="nx">makeApiList</span><span class="p">(</span><span class="nx">distroConfig</span><span class="p">);</span>
</code></pre>
</div>

<p>This is a <a href="https://github.com/linode/manager/blob/9757e6455556d12bba0864a3050c4293b5ec9bd0/src/api-store.js#L24-L157">much more complicated
function</a>,
so I’ll break it down in parts. The core part of most Redux reducers is the
<code class="highlighter-rouge">switch...case</code> statement:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">export</span> <span class="k">default</span> <span class="kd">function</span> <span class="nx">makeApiList</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">actions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">updateItem</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="na">updateItems</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="na">deleteItem</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">...</span><span class="nx">config</span><span class="p">.</span><span class="nx">actions</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kr">const</span> <span class="nx">mergedConfig</span> <span class="o">=</span> <span class="p">{</span> <span class="p">...</span><span class="nx">config</span><span class="p">,</span> <span class="nx">actions</span> <span class="p">};</span>
  <span class="kr">const</span> <span class="nx">defaultState</span> <span class="o">=</span> <span class="nx">makeDefaultState</span><span class="p">(</span><span class="nx">mergedConfig</span><span class="p">);</span>

  <span class="c1">// ...</span>

  <span class="kd">function</span> <span class="nx">handleAction</span><span class="p">(</span><span class="nx">_config</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="nx">_config</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">updateItems</span><span class="err">:</span>
        <span class="k">return</span> <span class="nx">updateMany</span><span class="p">(</span><span class="nx">_config</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
      <span class="k">case</span> <span class="nx">_config</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">updateItem</span><span class="err">:</span>
        <span class="k">return</span> <span class="nx">updateItem</span><span class="p">(</span><span class="nx">_config</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
      <span class="k">case</span> <span class="nx">_config</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">deleteItem</span><span class="err">:</span>
        <span class="k">return</span> <span class="nx">deleteOne</span><span class="p">(</span><span class="nx">_config</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
      <span class="nl">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="nx">state</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">(</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">defaultState</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="nx">handleAction</span><span class="p">(</span><span class="nx">mergedConfig</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Some of the less relevant features of our system (filtering and caching and
subresources) are again omitted. This switches on the action type, but checks
for actions whose type is one provided in the config object. The Redux state for
an API store looks something like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">distributions</span><span class="p">:</span> <span class="p">{</span>
    <span class="nl">pagesFetched</span><span class="p">:</span> <span class="p">[</span> <span class="mi">1</span> <span class="p">],</span>
    <span class="nx">totalPages</span><span class="err">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">totalResults</span><span class="err">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nx">singular</span><span class="err">:</span> <span class="s2">"distribution"</span><span class="p">,</span>
    <span class="nx">plural</span><span class="err">:</span> <span class="s2">"distributions"</span><span class="p">,</span>
    <span class="nx">distributions</span><span class="err">:</span> <span class="p">{</span>
      <span class="s2">"linode/debian8"</span><span class="err">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
      <span class="s2">"linode/fedora21"</span><span class="err">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
      <span class="s2">"linode/ubuntu15.4"</span><span class="err">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">},</span>
      <span class="c1">// ...</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The “distributions” object is keyed on the ID of the resource. So, the
implementation for <code class="highlighter-rouge">_config.actions.updateItem</code> looks like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code>  <span class="kd">function</span> <span class="nx">updateItem</span><span class="p">(</span><span class="nx">_config</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">action</span><span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">singular</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
      <span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">plural</span><span class="p">]:</span> <span class="p">{</span>
        <span class="p">...</span><span class="nx">state</span><span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">plural</span><span class="p">],</span>
        <span class="p">[</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">]:</span> <span class="p">{</span>
          <span class="p">...</span><span class="nx">state</span><span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">plural</span><span class="p">][</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">],</span>
          <span class="p">...</span><span class="nx">item</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">},</span>
    <span class="p">};</span>
  <span class="p">}</span>
</code></pre>
</div>

<p>The implementation for updating a page of items looks like this:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">updateMany</span><span class="p">(</span><span class="nx">_config</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">action</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="p">{</span> <span class="nx">response</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">action</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="p">...</span><span class="nx">state</span><span class="p">,</span>
    <span class="na">pagesFetched</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">...</span><span class="nx">state</span><span class="p">.</span><span class="nx">pagesFetched</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span> <span class="o">=&gt;</span> <span class="nx">p</span> <span class="o">!==</span> <span class="nx">response</span><span class="p">.</span><span class="nx">page</span><span class="p">),</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">page</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="na">totalPages</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">total_pages</span><span class="p">,</span>
    <span class="na">totalResults</span><span class="p">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">total_results</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">plural</span><span class="p">]:</span> <span class="p">{</span>
      <span class="p">...</span><span class="nx">state</span><span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">plural</span><span class="p">],</span>
      <span class="p">...</span><span class="nx">response</span><span class="p">[</span><span class="nx">_config</span><span class="p">.</span><span class="nx">plural</span><span class="p">].</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="p">({</span> <span class="p">...</span><span class="nx">s</span><span class="p">,</span> <span class="p">[</span><span class="nx">i</span><span class="p">.</span><span class="nx">id</span><span class="p">]:</span> <span class="nx">transform</span><span class="p">(</span>
           <span class="nx">transformItem</span><span class="p">(</span><span class="nx">_config</span><span class="p">.</span><span class="nx">subresources</span><span class="p">,</span> <span class="nx">i</span><span class="p">))</span> <span class="p">}),</span> <span class="p">{</span> <span class="p">}),</span>
    <span class="p">},</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre>
</div>

<h2 id="extra-details">Extra details</h2>

<p>I omitted several things from these examples that you could investigate more in
our <a href="https://github.com/Linode/manager">GitHub repository</a> if it interests you,
such as:</p>

<ul>
  <li>Server-side filtering</li>
  <li>Caching and cache invalidation</li>
  <li>Subresources (such as /linodes/:id/disks)</li>
</ul>

<p>Thanks for stopping by! I hope you’ve learned something neat to apply to your
own React projects. I’ll leave you with the simple code for our most complicated
set of API endpoints, the Linodes endpoints:</p>

<div class="language-javascript highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="p">{</span>
  <span class="nx">makeFetchPage</span><span class="p">,</span>
  <span class="nx">makeFetchAll</span><span class="p">,</span>
  <span class="nx">makeFetchItem</span><span class="p">,</span>
  <span class="nx">makeFetchUntil</span><span class="p">,</span>
  <span class="nx">makeDeleteItem</span><span class="p">,</span>
  <span class="nx">makePutItem</span><span class="p">,</span>
  <span class="nx">makeCreateItem</span><span class="p">,</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">'~/api-store'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_LINODES</span> <span class="o">=</span> <span class="s1">'@@linodes/UPDATE_LINODES'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_LINODE</span> <span class="o">=</span> <span class="s1">'@@linodes/UPDATE_LINODE'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">DELETE_LINODE</span> <span class="o">=</span> <span class="s1">'@@linodes/DELETE_LINODE'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_LINODE_CONFIG</span> <span class="o">=</span> <span class="s1">'@@linodes/UPDATE_LINODE_CONFIG'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_LINODE_CONFIGS</span> <span class="o">=</span> <span class="s1">'@@linodes/UPDATE_LINODE_CONFIGS'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">DELETE_LINODE_CONFIG</span> <span class="o">=</span> <span class="s1">'@@linodes/DELETE_LINODE_CONFIG'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_LINODE_DISK</span> <span class="o">=</span> <span class="s1">'@@linodes/UPDATE_LINODE_DISK'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_LINODE_DISKS</span> <span class="o">=</span> <span class="s1">'@@linodes/UPDATE_LINODE_DISKS'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">DELETE_LINODE_DISK</span> <span class="o">=</span> <span class="s1">'@@linodes/DELETE_LINODE_DISK'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_BACKUPS</span> <span class="o">=</span> <span class="s1">'@@backups/UPDATE_BACKUPS'</span><span class="p">;</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">UPDATE_BACKUP</span> <span class="o">=</span> <span class="s1">'@@backups/UPDATE_BACKUP'</span><span class="p">;</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">linodeConfig</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">plural</span><span class="p">:</span> <span class="s1">'linodes'</span><span class="p">,</span>
  <span class="na">singular</span><span class="p">:</span> <span class="s1">'linode'</span><span class="p">,</span>
  <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">updateItem</span><span class="p">:</span> <span class="nx">UPDATE_LINODE</span><span class="p">,</span>
    <span class="na">updateItems</span><span class="p">:</span> <span class="nx">UPDATE_LINODES</span><span class="p">,</span>
    <span class="na">deleteItem</span><span class="p">:</span> <span class="nx">DELETE_LINODE</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">subresources</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">_configs</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">plural</span><span class="p">:</span> <span class="s1">'configs'</span><span class="p">,</span>
      <span class="na">singular</span><span class="p">:</span> <span class="s1">'config'</span><span class="p">,</span>
      <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">updateItem</span><span class="p">:</span> <span class="nx">UPDATE_LINODE_CONFIG</span><span class="p">,</span>
        <span class="na">updateItems</span><span class="p">:</span> <span class="nx">UPDATE_LINODE_CONFIGS</span><span class="p">,</span>
        <span class="na">deleteItem</span><span class="p">:</span> <span class="nx">DELETE_LINODE_CONFIG</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="na">_disks</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">plural</span><span class="p">:</span> <span class="s1">'disks'</span><span class="p">,</span>
      <span class="na">singular</span><span class="p">:</span> <span class="s1">'disk'</span><span class="p">,</span>
      <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">updateItem</span><span class="p">:</span> <span class="nx">UPDATE_LINODE_DISK</span><span class="p">,</span>
        <span class="na">updateItems</span><span class="p">:</span> <span class="nx">UPDATE_LINODE_DISKS</span><span class="p">,</span>
        <span class="na">deleteItem</span><span class="p">:</span> <span class="nx">DELETE_LINODE_DISK</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
    <span class="na">_backups</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">plural</span><span class="p">:</span> <span class="s1">'backups'</span><span class="p">,</span>
      <span class="na">singular</span><span class="p">:</span> <span class="s1">'backup'</span><span class="p">,</span>
      <span class="na">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">updateItem</span><span class="p">:</span> <span class="nx">UPDATE_BACKUP</span><span class="p">,</span>
        <span class="na">updateItems</span><span class="p">:</span> <span class="nx">UPDATE_BACKUPS</span><span class="p">,</span>
      <span class="p">},</span>
    <span class="p">},</span>
  <span class="p">},</span>
<span class="p">};</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinodes</span> <span class="o">=</span> <span class="nx">makeFetchPage</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchAllLinodes</span> <span class="o">=</span> <span class="nx">makeFetchAll</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="nx">fetchLinodes</span><span class="p">);</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinode</span> <span class="o">=</span> <span class="nx">makeFetchItem</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinodeUntil</span> <span class="o">=</span> <span class="nx">makeFetchUntil</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">);</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">deleteLinode</span> <span class="o">=</span> <span class="nx">makeDeleteItem</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">putLinode</span> <span class="o">=</span> <span class="nx">makePutItem</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">createLinode</span> <span class="o">=</span> <span class="nx">makeCreateItem</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">);</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinodeDisk</span> <span class="o">=</span> <span class="nx">makeFetchItem</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="s1">'disks'</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinodeDisks</span> <span class="o">=</span> <span class="nx">makeFetchPage</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="s1">'_disks'</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchAllLinodeDisks</span> <span class="o">=</span> <span class="nx">makeFetchAll</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="nx">fetchLinodeDisks</span><span class="p">,</span> <span class="s1">'_disks'</span><span class="p">);</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinodeConfig</span> <span class="o">=</span> <span class="nx">makeFetchItem</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="s1">'configs'</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchLinodeConfigs</span> <span class="o">=</span> <span class="nx">makeFetchPage</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="s1">'_configs'</span><span class="p">);</span>
<span class="kr">export</span> <span class="kr">const</span> <span class="nx">fetchAllLinodeConfigs</span> <span class="o">=</span> <span class="nx">makeFetchAll</span><span class="p">(</span><span class="nx">linodeConfig</span><span class="p">,</span> <span class="nx">fetchLinodeConfigs</span><span class="p">,</span> <span class="s1">'_configs'</span><span class="p">);</span>
</code></pre>
</div>

        </div>
      </acticle>
    </div>
  </div>
</div>

    <footer class="container">
      <div class="row">
        <div class="col-md-10 text-xs-right">
          <span class="text-muted">
            &copy; Linode 2016, CC-BY-SA 4.0<br />
            <a href="https://github.com/Linode/blog">
              Source available on GitHub
              <i class="fa fa-github"></i>
            </a>
          </span>
        </div>
      </div>
    </footer>
  </body>
</html>
